# Cloudflare Workers Configuration for Chaos Garden
# This binds our simulation engine to the edge network

name = "chaos-garden-api"
main = "src/index.ts"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# ==========================================
# D1 Database Binding
# ==========================================
# This binds our SQLite database to the worker.
# The database must be created separately using:
#   wrangler d1 create chaos-garden-db

[[d1_databases]]
binding = "DB"
database_name = "chaos-garden-db"
database_id = ""  # Fill in after creating database with: wrangler d1 create chaos-garden-db
preview_database_id = "DB" # Required for Pages local development

# ==========================================
# Cron Triggers - The Heartbeat of Life
# ==========================================
# Runs simulation tick every 15 minutes (96 times per day)
# Time flows even when no one is watching.

[triggers]
crons = ["*/15 * * * *"]

# ==========================================
# Environment Variables
# ==========================================
# These are available in the worker via env.VARIABLE_NAME

[vars]
# CORS allowed origins (comma-separated for multiple)
CORS_ORIGIN = "*"
ENVIRONMENT = "production"

# ==========================================
# Development Environment
# ==========================================
[env.dev]
vars = { CORS_ORIGIN = "*", ENVIRONMENT = "development" }

[[env.dev.d1_databases]]
binding = "DB"
database_name = "chaos-garden-db"
database_id = "DB"
preview_database_id = "DB"

# ==========================================
# Build Configuration
# ==========================================
[build]
command = ""

# ==========================================
# TypeScript Path Mapping
# ==========================================
[alias]
"@chaos-garden/shared" = "../shared/types.ts"