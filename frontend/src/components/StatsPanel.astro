---
/**
 * Statistics Panel Component
 * 
 * Refactored to use Custom Elements for reactive updates.
 */

import type { GardenState } from '../env.d.ts';

export interface Props {
  // Initial state is optional as it will be updated by the parent
  gardenState?: GardenState;
}

---

<stats-panel class="block">
  <!-- Population Stats Bar -->
  <div class="flex space-x-8 px-6 py-3 rounded-full bg-white/10 backdrop-blur-md border border-white/20 shadow-2xl transition-all duration-300">
    <!-- Minimal Species Markers -->
    <div class="flex items-center space-x-8">
      <div class="flex flex-col items-center group cursor-default">
         <div class="w-2 h-2 rounded-full bg-garden-green-400 mb-1 shadow-[0_0_10px_rgba(74,222,128,0.5)]"></div>
         <span id="stat-plants" class="text-xs font-mono font-medium text-white/80 group-hover:text-white transition-colors">0</span>
      </div>
      
      <div class="flex flex-col items-center group cursor-default">
         <div class="w-2 h-2 rounded-full bg-yellow-400 mb-1 shadow-[0_0_10px_rgba(250,204,21,0.5)]"></div>
         <span id="stat-herbivores" class="text-xs font-mono font-medium text-white/80 group-hover:text-white transition-colors">0</span>
      </div>

      <div class="flex flex-col items-center group cursor-default">
         <div class="w-2 h-2 rounded-full bg-purple-400 mb-1 shadow-[0_0_10px_rgba(192,132,252,0.5)]"></div>
         <span id="stat-fungi" class="text-xs font-mono font-medium text-white/80 group-hover:text-white transition-colors">0</span>
      </div>

      <div class="flex flex-col items-center group cursor-default">
         <div class="w-2 h-2 rounded-full bg-red-400 mb-1 shadow-[0_0_10px_rgba(248,113,113,0.5)]"></div>
         <span id="stat-carnivores" class="text-xs font-mono font-medium text-white/80 group-hover:text-white transition-colors">0</span>
      </div>
    </div>

    <!-- Population Health Bar (Integrated) -->
    <div class="flex items-center space-x-3 border-l border-white/10 pl-8">
       <div class="w-24 h-[3px] bg-white/10 rounded-full relative overflow-hidden">
          <div id="bar-living" class="absolute inset-y-0 left-0 bg-white/60 transition-all duration-1000 shadow-[0_0_8px_rgba(255,255,255,0.3)]"></div>
       </div>
       <span id="stat-living" class="text-[10px] font-mono font-bold text-white/60 uppercase tracking-widest">Living</span>
    </div>
  </div>
</stats-panel>

<script>
  import type { GardenState } from '../env.d.ts';

  class StatsPanel extends HTMLElement {
    constructor() {
      super();
    }

    public updateState(gardenState: GardenState) {
      if (!gardenState) return;
      const summary = gardenState.populationSummary;
      
      this.updateText('stat-plants', summary.plants.toString());
      this.updateText('stat-herbivores', summary.herbivores.toString());
      this.updateText('stat-fungi', summary.fungi.toString());
      this.updateText('stat-carnivores', summary.carnivores.toString());
      this.updateText('stat-living', `${Math.round((summary.totalLiving / (summary.total || 1)) * 100)}%`);

      const bar = this.querySelector('#bar-living') as HTMLElement;
      if (bar) {
        bar.style.width = `${(summary.totalLiving / (summary.total || 1)) * 100}%`;
      }
    }

    private updateText(id: string, value: string) {
      const el = this.querySelector(`#${id}`);
      if (el) el.textContent = value;
    }

  }

  if (!customElements.get('stats-panel')) {
    customElements.define('stats-panel', StatsPanel);
  }
</script>
